@model FleaMarket.FrontEnd.Models.Item
@{
    ViewData["Title"] = Model.Name;
}

<!-- Page Header Start -->
<div class="container-fluid page-header py-5">
    <h1 class="text-center text-white display-6">@Model.Name</h1>
    <ol class="breadcrumb justify-content-center mb-0">
        <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index" class="text-white">Home</a></li>
        <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Browse" class="text-white">Browse</a></li>
        <li class="breadcrumb-item active text-white">@Model.Name</li>
    </ol>
</div>
<!-- Page Header End -->

<!-- Single Product Start -->
<div class="container-fluid shop py-5">
    <div class="container py-5">
        <div class="row g-5 justify-content-center">
            <div class="col-12 col-xxl-10">
                <div class="row g-5">
                    <!-- Sidebar Start -->
                    <div class="col-lg-5 col-xl-3">
                <div class="row g-4">
                    <!-- Seller Info -->
                    <div class="col-lg-12">
                        <div class="seller-info mb-4 p-4 border rounded bg-light">
                            <h5 class="mb-3">Seller Information</h5>
                            <div class="d-flex align-items-center mb-3">
                                @if (Model.Owner?.ProfileImageFileName != null)
                                {
                                    <img src="/uploads/@Model.Owner.ProfileImageFileName" 
                                         alt="@(Model.Owner.UserName ?? Model.Owner.Email)" 
                                         class="rounded-circle me-3 shadow-sm" 
                                         style="width:60px;height:60px;object-fit:cover;" />
                                }
                                else
                                {
                                    <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center me-3 shadow-sm" 
                                         style="width:60px;height:60px;color:white;font-weight:bold;font-size:20px;">
                                        @(string.IsNullOrEmpty(Model.Owner?.UserName) 
                                            ? Model.Owner?.Email?.Substring(0, 1).ToUpper() 
                                            : Model.Owner.UserName.Substring(0, 1).ToUpper())
                                    </div>
                                }
                                <div>
                                    <div class="fw-bold h6">
                                        @(Model.Owner?.UserName ?? Model.Owner?.Email?.Split('@')[0] ?? "Unknown")
                                    </div>
                                    <small class="text-muted">@Model.Owner?.Email</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Item Status -->
                    <div class="col-lg-12">
                        <div class="mb-4 p-4 border rounded">
                            <h5 class="mb-3">Item Status</h5>
                            <div class="d-flex flex-column">
                                <div class="mb-2">
                                    <strong>Status:</strong> 
                                    @if (Model.IsSold)
                                    {
                                        <span class="badge bg-danger">Sold</span>
                                    }
                                    else if (Model.IsReserved)
                                    {
                                        <span class="badge bg-warning">Reserved</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-success">Available</span>
                                    }
                                </div>
                                @if (Model.Deadline.HasValue)
                                {
                                    <div class="mb-2">
                                        <strong>Deadline:</strong> 
                                        <span class="text-muted">@Model.Deadline?.ToString("g")</span>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Sidebar End -->

                    <!-- Product Details Start -->
                    <div class="col-lg-7 col-xl-9 wow fadeInUp" data-wow-delay="0.1s">
                <div class="row g-4 single-product">
                    <div class="col-xl-6">
                        @if (Model.Images.Any())
                        {
                            <!-- Image Gallery -->
                            <div class="single-carousel owl-carousel" id="imageCarousel">
                                @foreach (var img in Model.Images)
                                {
                                    <div class="single-item" data-dot="<img class='img-fluid' src='/uploads/@img.FileName' alt='@Model.Name'>">
                                        <div class="single-inner bg-light rounded">
                                            <img src="/uploads/@img.FileName" class="img-fluid rounded" alt="@Model.Name" style="height: 400px; object-fit: cover; width: 100%;" data-lightbox="product-gallery">
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="single-item">
                                <div class="single-inner bg-light rounded d-flex align-items-center justify-content-center" style="height: 400px;">
                                    <div class="text-center text-muted">
                                        <i class="fas fa-image fa-4x mb-3"></i>
                                        <p>No images available</p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="col-xl-6">
                        <h4 class="fw-bold mb-3">@Model.Name</h4>
                        @if (Model.Price.HasValue)
                        {
                            <h5 class="fw-bold mb-3 text-primary">@Model.Price?.ToString("C")</h5>
                        }
                        else
                        {
                            <h5 class="fw-bold mb-3 text-success">FREE</h5>
                        }
                        
                        
                        <!-- Item Details -->
                        <div class="d-flex flex-column mb-3">
                            <small>Listed by: <strong class="text-primary">@(Model.Owner?.UserName ?? Model.Owner?.Email?.Split('@')[0] ?? "Unknown")</strong></small>
                            @if (Model.Deadline.HasValue)
                            {
                                <small>Deadline: <strong class="text-warning">@Model.Deadline?.ToString("g")</strong></small>
                            }
                        </div>
                        
                        <!-- Description -->
                        <p class="mb-4">@Model.Description</p>
                        
                        <!-- Action Buttons -->
                        <div class="d-flex align-items-center mb-5">
                            @if (!Model.IsReserved && !Model.IsSold)
                            {
                                <form asp-controller="Home" asp-action="Reserve" asp-route-id="@Model.Id" method="post" class="me-3">
                                    <button type="submit" class="btn btn-primary border-secondary rounded-pill py-3 px-4">
                                        <i class="fas fa-bookmark me-2"></i> Reserve Item
                                    </button>
                                </form>
                            }
                            else
                            {
                                <span class="btn btn-secondary rounded-pill py-3 px-4 me-3 disabled">
                                    @(Model.IsSold ? "Sold" : "Reserved")
                                </span>
                            }
                            <a asp-controller="Home" asp-action="Browse" class="btn btn-outline-primary rounded-pill py-3 px-4">
                                <i class="fas fa-arrow-left me-2"></i> Back to Browse
                            </a>
                        </div>
                    </div>
                </div>
                    </div>
                    <!-- Product Details End -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Single Product End -->

@section Scripts {
    <script>
        $(document).ready(function() {
            // Initialize Owl Carousel for product images
            $('.single-carousel').owlCarousel({
                autoplay: true,
                smartSpeed: 1000,
                items: 1,
                dots: true,
                loop: true,
                nav: false,
                dotsData: true
            });
            
            // Initialize lightbox for image viewing
            lightbox.option({
                'resizeDuration': 200,
                'wrapAround': true
            });
        });
    </script>
}

@section Styles {
    <style>
        .single-carousel .owl-dots {
            text-align: center;
            margin-top: 20px;
        }

        .single-carousel .owl-dot {
            display: inline-block;
            margin: 0 5px;
            border: 2px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .single-carousel .owl-dot img {
            width: 80px;
            height: 80px;
            object-fit: cover;
        }

        .single-carousel .owl-dot.active {
            border-color: #007bff;
        }

        .seller-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
        }

        .single-inner {
            transition: transform 0.3s ease;
        }

        .single-inner:hover {
            transform: scale(1.02);
        }

        .product-item-add {
            transition: all 0.3s ease;
        }

        .page-header {
            background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('/img/carousel-1.jpg');
            background-size: cover;
            background-position: center;
        }

        /* Ensure proper spacing and prevent footer overlap */
        .shop {
            margin-bottom: 4rem;
        }

        .single-product {
            margin-bottom: 3rem;
        }

        /* Fix image height for mobile to prevent overflow */
        @@media (max-width: 768px) {
            .single-inner img {
                max-height: 300px;
                object-fit: cover;
            }
        }
    </style>
}
